<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="15" skipped="1" tests="21" time="1.661" timestamp="2025-06-12T14:11:38.122319" hostname="macpro.local"><testcase classname="" name="tests.cli.test_eval_tool" time="0.000"><skipped message="collection skipped">('/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/tests/cli/test_eval_tool.py', 20, 'Skipped: eval tool not available')</skipped></testcase><testcase classname="tests.api.test_web_app.TestHealthEndpoint" name="test_health_check" time="0.005"><failure message="AssertionError: assert 'timestamp' in {'service': 'raft-toolkit', 'status': 'healthy'}">self = &lt;tests.api.test_web_app.TestHealthEndpoint object at 0x107466730&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c6d9460&gt;

    @pytest.mark.api
    def test_health_check(self, client):
        """Test health check endpoint."""
        response = client.get("/health")
    
        assert response.status_code == 200
        data = response.json()
        assert data["status"] == "healthy"
&gt;       assert "timestamp" in data
E       AssertionError: assert 'timestamp' in {'service': 'raft-toolkit', 'status': 'healthy'}

tests/api/test_web_app.py:41: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestConfigEndpoint" name="test_get_config" time="0.002"><failure message="assert 404 == 200&#10; +  where 404 = &lt;Response [404 Not Found]&gt;.status_code">self = &lt;tests.api.test_web_app.TestConfigEndpoint object at 0x107466940&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c6d9f10&gt;

    @pytest.mark.api
    def test_get_config(self, client):
        """Test getting default configuration."""
        response = client.get("/api/config")
    
&gt;       assert response.status_code == 200
E       assert 404 == 200
E        +  where 404 = &lt;Response [404 Not Found]&gt;.status_code

tests/api/test_web_app.py:54: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestUploadEndpoint" name="test_upload_file_success" time="0.003"><failure message="assert 400 == 200&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">self = &lt;tests.api.test_web_app.TestUploadEndpoint object at 0x107466be0&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c705370&gt;
temp_upload_file = PosixPath('/var/folders/m7/lmjxc8td42b8yhzm9zgr26kc0000gn/T/tmpwkupgjtm/test_upload.txt')

    @pytest.mark.api
    def test_upload_file_success(self, client, temp_upload_file):
        """Test successful file upload."""
        with open(temp_upload_file, "rb") as f:
            response = client.post(
                "/api/upload",
                files={"file": ("test.txt", f, "text/plain")}
            )
    
&gt;       assert response.status_code == 200
E       assert 400 == 200
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/api/test_web_app.py:85: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestUploadEndpoint" name="test_upload_file_no_file" time="0.002"><failure message="assert 422 == 400&#10; +  where 422 = &lt;Response [422 Unprocessable Entity]&gt;.status_code">self = &lt;tests.api.test_web_app.TestUploadEndpoint object at 0x107466dc0&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c760c40&gt;

    @pytest.mark.api
    def test_upload_file_no_file(self, client):
        """Test upload endpoint with no file."""
        response = client.post("/api/upload")
    
&gt;       assert response.status_code == 400
E       assert 422 == 400
E        +  where 422 = &lt;Response [422 Unprocessable Entity]&gt;.status_code

tests/api/test_web_app.py:98: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestUploadEndpoint" name="test_upload_file_empty_filename" time="0.001"><failure message="assert 422 == 400&#10; +  where 422 = &lt;Response [422 Unprocessable Entity]&gt;.status_code">self = &lt;tests.api.test_web_app.TestUploadEndpoint object at 0x107466fa0&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c84cfa0&gt;

    @pytest.mark.api
    def test_upload_file_empty_filename(self, client):
        """Test upload with empty filename."""
        response = client.post(
            "/api/upload",
            files={"file": ("", b"content", "text/plain")}
        )
    
&gt;       assert response.status_code == 400
E       assert 422 == 400
E        +  where 422 = &lt;Response [422 Unprocessable Entity]&gt;.status_code

tests/api/test_web_app.py:111: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestProcessEndpoint" name="test_start_processing_success" time="0.002"><failure message="KeyError: 'file_path'">self = &lt;tests.api.test_web_app.TestProcessEndpoint object at 0x1074668b0&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c84c790&gt;
temp_upload_file = PosixPath('/var/folders/m7/lmjxc8td42b8yhzm9zgr26kc0000gn/T/tmpc2xq7oq2/test_upload.txt')

    @pytest.mark.api
    def test_start_processing_success(self, client, temp_upload_file):
        """Test starting processing job successfully."""
        # First upload a file
        with open(temp_upload_file, "rb") as f:
            upload_response = client.post(
                "/api/upload",
                files={"file": ("test.txt", f, "text/plain")}
            )
    
&gt;       file_path = upload_response.json()["file_path"]
E       KeyError: 'file_path'

tests/api/test_web_app.py:131: KeyError</failure></testcase><testcase classname="tests.api.test_web_app.TestProcessEndpoint" name="test_start_processing_missing_file" time="0.129"><failure message="assert 200 == 400&#10; +  where 200 = &lt;Response [200 OK]&gt;.status_code">self = &lt;tests.api.test_web_app.TestProcessEndpoint object at 0x107209190&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c810220&gt;

    @pytest.mark.api
    def test_start_processing_missing_file(self, client):
        """Test starting processing with missing file."""
        process_request = {
            "output_format": "hf",
            "doctype": "txt"
        }
    
        response = client.post(
            "/api/process?file_path=nonexistent.txt",
            json=process_request
        )
    
&gt;       assert response.status_code == 400
E       assert 200 == 400
E        +  where 200 = &lt;Response [200 OK]&gt;.status_code

tests/api/test_web_app.py:171: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestProcessEndpoint" name="test_start_processing_invalid_config" time="0.002"><failure message="KeyError: 'file_path'">self = &lt;tests.api.test_web_app.TestProcessEndpoint object at 0x107209400&gt;
client = &lt;starlette.testclient.TestClient object at 0x10cdcdd60&gt;
temp_upload_file = PosixPath('/var/folders/m7/lmjxc8td42b8yhzm9zgr26kc0000gn/T/tmptojmdckh/test_upload.txt')

    @pytest.mark.api
    def test_start_processing_invalid_config(self, client, temp_upload_file):
        """Test starting processing with invalid configuration."""
        # Upload file first
        with open(temp_upload_file, "rb") as f:
            upload_response = client.post(
                "/api/upload",
                files={"file": ("test.txt", f, "text/plain")}
            )
    
&gt;       file_path = upload_response.json()["file_path"]
E       KeyError: 'file_path'

tests/api/test_web_app.py:186: KeyError</failure></testcase><testcase classname="tests.api.test_web_app.TestJobStatusEndpoint" name="test_get_job_status_success" time="0.001"><failure message="assert 405 == 200&#10; +  where 405 = &lt;Response [405 Method Not Allowed]&gt;.status_code">self = &lt;tests.api.test_web_app.TestJobStatusEndpoint object at 0x107209670&gt;
client = &lt;starlette.testclient.TestClient object at 0x10c818b20&gt;

    @pytest.mark.api
    def test_get_job_status_success(self, client):
        """Test getting job status for existing job."""
        # Create a mock job
        job_id = "test-job-123"
        jobs[job_id] = {
            "id": job_id,
            "status": JobStatus.PROCESSING,
            "progress": 50,
            "total_chunks": 10,
            "processed_chunks": 5,
            "created_at": "2024-01-01T00:00:00",
            "config": {"doctype": "txt", "questions": 3}
        }
    
        response = client.get(f"/api/jobs/{job_id}")
    
&gt;       assert response.status_code == 200
E       assert 405 == 200
E        +  where 405 = &lt;Response [405 Method Not Allowed]&gt;.status_code

tests/api/test_web_app.py:226: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestJobStatusEndpoint" name="test_get_job_status_not_found" time="0.001"><failure message="assert 405 == 404&#10; +  where 405 = &lt;Response [405 Method Not Allowed]&gt;.status_code">self = &lt;tests.api.test_web_app.TestJobStatusEndpoint object at 0x107209880&gt;
client = &lt;starlette.testclient.TestClient object at 0x1102cf310&gt;

    @pytest.mark.api
    def test_get_job_status_not_found(self, client):
        """Test getting status for non-existent job."""
        response = client.get("/api/jobs/nonexistent-job")
    
&gt;       assert response.status_code == 404
E       assert 405 == 404
E        +  where 405 = &lt;Response [405 Method Not Allowed]&gt;.status_code

tests/api/test_web_app.py:240: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestJobStatusEndpoint" name="test_get_all_jobs" time="0.001"><failure message="KeyError: 'progress'">+ Exception Group Traceback (most recent call last):
  |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 181, in __call__
  |     recv_stream.close()
  |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 340, in from_call
    |     result: Optional[TResult] = func()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 240, in &lt;lambda&gt;
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/threadexception.py", line 87, in pytest_runtest_call
    |     yield from thread_exception_runtest_hook()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/threadexception.py", line 63, in thread_exception_runtest_hook
    |     yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/unraisableexception.py", line 90, in pytest_runtest_call
    |     yield from unraisable_exception_runtest_hook()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/unraisableexception.py", line 65, in unraisable_exception_runtest_hook
    |     yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/logging.py", line 849, in pytest_runtest_call
    |     yield from self._runtest_for(item, "call")
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/logging.py", line 832, in _runtest_for
    |     yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/capture.py", line 883, in pytest_runtest_call
    |     return (yield)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/skipping.py", line 256, in pytest_runtest_call
    |     return (yield)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 182, in pytest_runtest_call
    |     raise e
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 172, in pytest_runtest_call
    |     item.runtest()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 1772, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 195, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/tests/api/test_web_app.py", line 262, in test_get_all_jobs
    |     response = client.get("/api/jobs")
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 465, in get
    |     return super().get(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 1053, in get
    |     return self.request(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 437, in request
    |     return super().request(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 825, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 1014, in _send_single_request
    |     response = transport.handle_request(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 340, in handle_request
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 337, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py", line 290, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |   File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 445, in result
    |     return self.__get_result()
    |   File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 390, in __get_result
    |     raise self._exception
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py", line 221, in _call_func
    |     retval = await retval_or_awaitable
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 112, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 187, in __call__
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 181, in __call__
    |     recv_stream.close()
    |   File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    |     self.gen.throw(type, value, traceback)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/web/app.py", line 105, in add_security_headers
    |     response = await call_next(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/web/app.py", line 406, in list_jobs
    |     return [
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/web/app.py", line 410, in &lt;listcomp&gt;
    |     progress=job["progress"],
    | KeyError: 'progress'
    +------------------------------------

During handling of the above exception, another exception occurred:

self = &lt;tests.api.test_web_app.TestJobStatusEndpoint object at 0x107209a90&gt;
client = &lt;starlette.testclient.TestClient object at 0x1102c5be0&gt;

    @pytest.mark.api
    def test_get_all_jobs(self, client):
        """Test getting all jobs."""
        # Clear existing jobs
        jobs.clear()
    
        # Add test jobs
        jobs["job1"] = {
            "id": "job1",
            "status": JobStatus.COMPLETED,
            "created_at": "2024-01-01T00:00:00"
        }
        jobs["job2"] = {
            "id": "job2",
            "status": JobStatus.PROCESSING,
            "created_at": "2024-01-01T01:00:00"
        }
    
&gt;       response = client.get("/api/jobs")

tests/api/test_web_app.py:262: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:465: in get
    return super().get(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1053: in get
    return self.request(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:437: in request
    return super().request(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:340: in handle_request
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:337: in handle_request
    portal.call(self.app, scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:290: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:221: in _call_func
    retval = await retval_or_awaitable
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/applications.py:112: in __call__
    await self.middleware_stack(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:187: in __call__
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:165: in __call__
    await self.app(scope, receive, _send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:181: in __call__
    recv_stream.close()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:135: in __exit__
    self.gen.throw(type, value, traceback)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py:82: in collapse_excgroups
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:178: in __call__
    response = await self.dispatch_func(request, call_next)
web/app.py:105: in add_security_headers
    response = await call_next(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:156: in call_next
    raise app_exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:141: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:714: in __call__
    await self.middleware_stack(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:734: in app
    await route.handle(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:288: in handle
    await self.app(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:76: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:73: in app
    response = await f(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:301: in app
    raw_response = await run_endpoint_function(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:212: in run_endpoint_function
    return await dependant.call(**values)
web/app.py:406: in list_jobs
    return [
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

.0 = &lt;dict_itemiterator object at 0x1102d3590&gt;

    return [
        JobStatus(
            job_id=job_id,
            status=job["status"],
&gt;           progress=job["progress"],
            message=job["message"],
            stats=job.get("stats"),
            error=job.get("error")
        )
        for job_id, job in jobs.items()
    ]
E   KeyError: 'progress'

web/app.py:410: KeyError</failure></testcase><testcase classname="tests.api.test_web_app.TestJobStatusEndpoint" name="test_delete_job_success" time="0.001"><failure message="KeyError: 'config'">+ Exception Group Traceback (most recent call last):
  |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 181, in __call__
  |     recv_stream.close()
  |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | exceptiongroup.ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 340, in from_call
    |     result: Optional[TResult] = func()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 240, in &lt;lambda&gt;
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/threadexception.py", line 87, in pytest_runtest_call
    |     yield from thread_exception_runtest_hook()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/threadexception.py", line 63, in thread_exception_runtest_hook
    |     yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/unraisableexception.py", line 90, in pytest_runtest_call
    |     yield from unraisable_exception_runtest_hook()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/unraisableexception.py", line 65, in unraisable_exception_runtest_hook
    |     yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/logging.py", line 849, in pytest_runtest_call
    |     yield from self._runtest_for(item, "call")
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/logging.py", line 832, in _runtest_for
    |     yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/capture.py", line 883, in pytest_runtest_call
    |     return (yield)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/skipping.py", line 256, in pytest_runtest_call
    |     return (yield)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 182, in pytest_runtest_call
    |     raise e
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/runner.py", line 172, in pytest_runtest_call
    |     item.runtest()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 1772, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 167, in _multicall
    |     raise exception
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/pluggy/_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/_pytest/python.py", line 195, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/tests/api/test_web_app.py", line 281, in test_delete_job_success
    |     response = client.delete(f"/api/jobs/{job_id}")
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 627, in delete
    |     return super().delete(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 1251, in delete
    |     return self.request(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 437, in request
    |     return super().request(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 825, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py", line 1014, in _send_single_request
    |     response = transport.handle_request(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 340, in handle_request
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py", line 337, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py", line 290, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |   File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 445, in result
    |     return self.__get_result()
    |   File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 390, in __get_result
    |     raise self._exception
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py", line 221, in _call_func
    |     retval = await retval_or_awaitable
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/applications.py", line 112, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 187, in __call__
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 181, in __call__
    |     recv_stream.close()
    |   File "/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py", line 135, in __exit__
    |     self.gen.throw(type, value, traceback)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 178, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/web/app.py", line 105, in add_security_headers
    |     response = await call_next(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 156, in call_next
    |     raise app_exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py", line 141, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |   File "/Volumes/Studio/Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |   File "/Volumes/Studio/Sources/AI Projects/local-raft-toolkit/raft-toolkit/web/app.py", line 425, in delete_job
    |     config: RaftConfig = job["config"]
    | KeyError: 'config'
    +------------------------------------

During handling of the above exception, another exception occurred:

self = &lt;tests.api.test_web_app.TestJobStatusEndpoint object at 0x107209ca0&gt;
client = &lt;starlette.testclient.TestClient object at 0x10cdc80d0&gt;

    @pytest.mark.api
    def test_delete_job_success(self, client):
        """Test deleting a job successfully."""
        job_id = "delete-test-job"
        jobs[job_id] = {
            "id": job_id,
            "status": JobStatus.COMPLETED,
            "created_at": "2024-01-01T00:00:00"
        }
    
&gt;       response = client.delete(f"/api/jobs/{job_id}")

tests/api/test_web_app.py:281: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:627: in delete
    return super().delete(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1251: in delete
    return self.request(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:437: in request
    return super().request(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:340: in handle_request
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/testclient.py:337: in handle_request
    portal.call(self.app, scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:290: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445: in result
    return self.__get_result()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390: in __get_result
    raise self._exception
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/anyio/from_thread.py:221: in _call_func
    retval = await retval_or_awaitable
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/applications.py:1054: in __call__
    await super().__call__(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/applications.py:112: in __call__
    await self.middleware_stack(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:187: in __call__
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/errors.py:165: in __call__
    await self.app(scope, receive, _send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:181: in __call__
    recv_stream.close()
/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/contextlib.py:135: in __exit__
    self.gen.throw(type, value, traceback)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_utils.py:82: in collapse_excgroups
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:178: in __call__
    response = await self.dispatch_func(request, call_next)
web/app.py:105: in add_security_headers
    response = await call_next(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:156: in call_next
    raise app_exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/base.py:141: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/cors.py:85: in __call__
    await self.app(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/middleware/exceptions.py:62: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:714: in __call__
    await self.middleware_stack(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:734: in app
    await route.handle(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:288: in handle
    await self.app(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:76: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/starlette/routing.py:73: in app
    response = await f(request)
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:301: in app
    raw_response = await run_endpoint_function(
../../../../Users/corn/Library/Python/3.9/lib/python/site-packages/fastapi/routing.py:212: in run_endpoint_function
    return await dependant.call(**values)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

job_id = 'delete-test-job'

    @app.delete("/api/jobs/{job_id}")
    async def delete_job(job_id: str):
        """Delete a job and its files."""
        if job_id not in jobs:
            raise HTTPException(status_code=404, detail="Job not found")
    
        job = jobs[job_id]
&gt;       config: RaftConfig = job["config"]
E       KeyError: 'config'

web/app.py:425: KeyError</failure></testcase><testcase classname="tests.api.test_web_app.TestJobStatusEndpoint" name="test_delete_job_not_found" time="0.003" /><testcase classname="tests.api.test_web_app.TestDownloadEndpoint" name="test_download_completed_job" time="0.002"><failure message="assert 400 == 200&#10; +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code">self = &lt;tests.api.test_web_app.TestDownloadEndpoint object at 0x1072021f0&gt;
client = &lt;starlette.testclient.TestClient object at 0x11052b8e0&gt;
temp_directory = PosixPath('/var/folders/m7/lmjxc8td42b8yhzm9zgr26kc0000gn/T/tmp8nydvhd1')

    @pytest.mark.api
    def test_download_completed_job(self, client, temp_directory):
        """Test downloading results from completed job."""
        job_id = "download-test-job"
    
        # Create mock output directory with files
        output_dir = temp_directory / "output"
        output_dir.mkdir()
    
        # Create test files
        (output_dir / "dataset.jsonl").write_text('{"test": "data"}\n')
        (output_dir / "metadata.json").write_text('{"info": "test"}')
    
        jobs[job_id] = {
            "id": job_id,
            "status": JobStatus.COMPLETED,
            "output_path": str(output_dir),
            "created_at": "2024-01-01T00:00:00"
        }
    
        response = client.get(f"/api/jobs/{job_id}/download")
    
&gt;       assert response.status_code == 200
E       assert 400 == 200
E        +  where 400 = &lt;Response [400 Bad Request]&gt;.status_code

tests/api/test_web_app.py:324: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestDownloadEndpoint" name="test_download_job_not_completed" time="0.001" /><testcase classname="tests.api.test_web_app.TestDownloadEndpoint" name="test_download_job_not_found" time="0.001" /><testcase classname="tests.api.test_web_app.TestPreviewEndpoint" name="test_get_preview_success" time="0.002"><failure message="KeyError: 'file_path'">self = &lt;tests.api.test_web_app.TestPreviewEndpoint object at 0x1072028e0&gt;
client = &lt;starlette.testclient.TestClient object at 0x11098b100&gt;
temp_upload_file = PosixPath('/var/folders/m7/lmjxc8td42b8yhzm9zgr26kc0000gn/T/tmprj5_r0vl/test_upload.txt')

    @pytest.mark.api
    def test_get_preview_success(self, client, temp_upload_file):
        """Test getting processing preview."""
        # Upload file first
        with open(temp_upload_file, "rb") as f:
            upload_response = client.post(
                "/api/upload",
                files={"file": ("test.txt", f, "text/plain")}
            )
    
&gt;       file_path = upload_response.json()["file_path"]
E       KeyError: 'file_path'

tests/api/test_web_app.py:368: KeyError</failure></testcase><testcase classname="tests.api.test_web_app.TestPreviewEndpoint" name="test_get_preview_missing_file" time="0.003"><failure message="assert 422 == 400&#10; +  where 422 = &lt;Response [422 Unprocessable Entity]&gt;.status_code">self = &lt;tests.api.test_web_app.TestPreviewEndpoint object at 0x107202ac0&gt;
client = &lt;starlette.testclient.TestClient object at 0x110525d60&gt;

    @pytest.mark.api
    def test_get_preview_missing_file(self, client):
        """Test preview with missing file."""
        preview_request = {
            "doctype": "txt",
            "chunking_strategy": "fixed"
        }
    
        response = client.post(
            "/api/preview?file_path=nonexistent.txt",
            json=preview_request
        )
    
&gt;       assert response.status_code == 400
E       assert 422 == 400
E        +  where 422 = &lt;Response [422 Unprocessable Entity]&gt;.status_code

tests/api/test_web_app.py:414: AssertionError</failure></testcase><testcase classname="tests.api.test_web_app.TestStaticFiles" name="test_serve_index_html" time="0.004" /><testcase classname="tests.api.test_web_app.TestStaticFiles" name="test_serve_static_js" time="0.002" /></testsuite></testsuites>